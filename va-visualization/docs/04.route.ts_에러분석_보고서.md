# 04. route.ts ì—ëŸ¬ ë¶„ì„ ë³´ê³ ì„œ

> **ë¬¸ì œ**: app/api/statistics/route.ts íŒŒì¼ì˜ íƒ€ì… ë¶ˆì¼ì¹˜ ë° ì»´íŒŒì¼ ì—ëŸ¬  
> **ë‚ ì§œ**: 2025ë…„ 1ì›” 27ì¼  
> **í”„ë¡œì íŠ¸**: V-A ê°ì • ê³µê°„ ì‹œê°í™”  
> **ìƒíƒœ**: ğŸ”´ Critical - ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

---

## ğŸš¨ 1. ì—ëŸ¬ ìš”ì•½

| ì—ëŸ¬ ìœ í˜• | ê°œìˆ˜ | ì‹¬ê°ë„ | ì˜í–¥ ë²”ìœ„ |
|-----------|------|--------|-----------|
| íƒ€ì… ë¶ˆì¼ì¹˜ | 4ê°œ | ğŸ”´ Critical | ì»´íŒŒì¼ ì‹¤íŒ¨ |
| í•¨ìˆ˜ ì¤‘ë³µ ì •ì˜ | 1ê°œ | ğŸ”´ Critical | ëª¨í˜¸í•œ ì°¸ì¡° |
| Import ëˆ„ë½ | 1ê°œ | ğŸŸ¡ High | ëŸ°íƒ€ì„ ì—ëŸ¬ |
| ëŸ°íƒ€ì„ ì—ëŸ¬ ê°€ëŠ¥ì„± | 3ê°œ | ğŸ”´ Critical | ì˜ëª»ëœ ê³„ì‚° |
| **ì´ê³„** | **9ê°œ** | - | **ì‹œìŠ¤í…œ ë¶ˆì•ˆì •** |

---

## ğŸ” 2. ìƒì„¸ ì—ëŸ¬ ë¶„ì„

### 2.1 íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ (Critical)

| ë¼ì¸ | route.ts ì‚¬ìš© | IRawEmotionData ì •ì˜ | ì‹¤ì œ JSON ë°ì´í„° | ìƒíƒœ |
|------|---------------|---------------------|------------------|------|
| 27 | `e.valence` | `valence_mean` | `"valence"` | âŒ 3ì¤‘ ë¶ˆì¼ì¹˜ |
| 28 | `e.arousal` | `arousal_mean` | `"arousal"` | âŒ 3ì¤‘ ë¶ˆì¼ì¹˜ |
| 132 | `valence` | `valence_mean` | `"valence"` | âŒ 3ì¤‘ ë¶ˆì¼ì¹˜ |
| 132 | `arousal` | `arousal_mean` | `"arousal"` | âŒ 3ì¤‘ ë¶ˆì¼ì¹˜ |

### 2.2 í•¨ìˆ˜ ì¤‘ë³µ ì •ì˜ ë¬¸ì œ (Critical)

| í•¨ìˆ˜ëª… | ì •ì˜ ìœ„ì¹˜ 1 | ì •ì˜ ìœ„ì¹˜ 2 | ì‚¬ìš© ë¼ì¸ | ìƒíƒœ |
|--------|-------------|-------------|-----------|------|
| `median()` | route.ts:109 | statistics.util.ts:22 | 51, 58, 65 | âŒ ì¤‘ë³µ ì •ì˜ |

### 2.3 Import ëˆ„ë½ ë¬¸ì œ (High)

| ë¼ì¸ | ëˆ„ë½ëœ Import | í˜„ì¬ Import | ìˆ˜ì • í•„ìš” |
|------|---------------|-------------|-----------|
| 13 | `median` | `mean, standardDeviation` | âœ… median ì¶”ê°€ í•„ìš” |

---

## âŒ 3. ì»´íŒŒì¼ ì—ëŸ¬ ìƒì„¸

### 3.1 TypeScript ì»´íŒŒì¼ ì—ëŸ¬

```typescript
// ë¼ì¸ 27: Property 'valence' does not exist on type 'IRawEmotionData'
const valences = emotions.map(e => e.valence);

// ë¼ì¸ 28: Property 'arousal' does not exist on type 'IRawEmotionData'
const arousals = emotions.map(e => e.arousal);

// ë¼ì¸ 132: Property 'valence' does not exist on type 'IRawEmotionData'
const { valence, arousal } = emotion;
```

### 3.2 ì—ëŸ¬ ë°œìƒ ì›ì¸

| ì›ì¸ | ì„¤ëª… | ì˜í–¥ |
|------|------|------|
| íƒ€ì… ì •ì˜ ë¶ˆì¼ì¹˜ | IRawEmotionDataê°€ `valence_mean`ìœ¼ë¡œ ì •ì˜ë¨ | ì»´íŒŒì¼ ì‹¤íŒ¨ |
| ì‹¤ì œ ë°ì´í„° ë¶ˆì¼ì¹˜ | JSON ë°ì´í„°ëŠ” `valence` í•„ë“œ ì‚¬ìš© | ëŸ°íƒ€ì„ ì—ëŸ¬ |
| ì½”ë“œ ì‚¬ìš© ë¶ˆì¼ì¹˜ | route.tsì—ì„œ `valence` í•„ë“œ ì ‘ê·¼ | íƒ€ì… ì—ëŸ¬ |

---

## âš ï¸ 4. ëŸ°íƒ€ì„ ì—ëŸ¬ ê°€ëŠ¥ì„±

### 4.1 ë°ì´í„° êµ¬ì¡° ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ì—ëŸ¬

| ë¬¸ì œ ìƒí™© | ì˜ˆìƒ ê²°ê³¼ | ì˜í–¥ |
|-----------|-----------|------|
| `e.valence` â†’ `undefined` | NaN ê³„ì‚° | í†µê³„ ê°’ ì˜¤ë¥˜ |
| `e.arousal` â†’ `undefined` | NaN ê³„ì‚° | í†µê³„ ê°’ ì˜¤ë¥˜ |
| ì‚¬ë¶„ë©´ ê³„ì‚° ì˜¤ë¥˜ | ëª¨ë“  ë°ì´í„°ê°€ Q4ë¡œ ë¶„ë¥˜ | ë¶„í¬ ë¶„ì„ ì‹¤íŒ¨ |

### 4.2 ê³„ì‚° ì—ëŸ¬ ìƒì„¸

| ë¼ì¸ | ê³„ì‚° | ì˜ˆìƒ ê²°ê³¼ | ì‹¤ì œ ê²°ê³¼ |
|------|------|-----------|-----------|
| 47 | `mean(valences)` | ìˆ«ì | NaN |
| 48 | `standardDeviation(valences)` | ìˆ«ì | NaN |
| 49 | `Math.min(...valences)` | ìˆ«ì | NaN |
| 50 | `Math.max(...valences)` | ìˆ«ì | NaN |

### 4.3 ì‚¬ë¶„ë©´ ë¶„í¬ ê³„ì‚° ì˜¤ë¥˜

| ì¡°ê±´ | ì˜ˆìƒ ë™ì‘ | ì‹¤ì œ ë™ì‘ |
|------|-----------|-----------|
| `valence >= 0 && arousal >= 0` | Q1 ì¦ê°€ | false (undefined >= 0) |
| `valence < 0 && arousal >= 0` | Q2 ì¦ê°€ | false (undefined < 0) |
| `valence < 0 && arousal < 0` | Q3 ì¦ê°€ | false (undefined < 0) |
| else | Q4 ì¦ê°€ | **ëª¨ë“  ë°ì´í„°ê°€ Q4ë¡œ ë¶„ë¥˜** |

---

## ğŸ”§ 5. ìˆ˜ì • ë°©ì•ˆ

### 5.1 ì¦‰ì‹œ ìˆ˜ì • (Critical)

#### A. íƒ€ì… ì •ì˜ ìˆ˜ì •

**íŒŒì¼**: `lib/types/emotion.types.ts`

```typescript
export interface IRawEmotionData {
  term: string;
  valence: number;        // valence_mean â†’ valenceë¡œ ë³€ê²½
  arousal: number;        // arousal_mean â†’ arousalë¡œ ë³€ê²½
  dominance_mean?: number;
  valence_sd?: number;
  arousal_sd?: number;
  dominance_sd?: number;
  merge_strategy?: string;
  confidence?: number;
  source_warriner?: boolean;
  source_nrc?: boolean;
  is_multiword?: boolean;
}
```

#### B. route.ts ìˆ˜ì •

**íŒŒì¼**: `app/api/statistics/route.ts`

```typescript
// ë¼ì¸ 13: median import ì¶”ê°€
import { mean, standardDeviation, median } from '@/lib/utils/math/statistics.util';

// ë¼ì¸ 109-118: ì¤‘ë³µ í•¨ìˆ˜ ì œê±°
// function median(values: number[]): number { ... } // ì‚­ì œ
```

### 5.2 ìˆ˜ì • ìš°ì„ ìˆœìœ„

| ìš°ì„ ìˆœìœ„ | ìˆ˜ì • í•­ëª© | ì˜ˆìƒ ì‹œê°„ | ì˜í–¥ë„ |
|----------|-----------|-----------|--------|
| 1 | íƒ€ì… ì •ì˜ ìˆ˜ì • | 5ë¶„ | ğŸ”´ Critical |
| 2 | median import ì¶”ê°€ | 2ë¶„ | ğŸŸ¡ High |
| 3 | ì¤‘ë³µ í•¨ìˆ˜ ì œê±° | 3ë¶„ | ğŸŸ¡ High |
| 4 | ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸ | 5ë¶„ | ğŸŸ¢ Medium |

---

## ğŸ“Š 6. ìˆ˜ì • í›„ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 6.1 ì»´íŒŒì¼ ê²€ì¦

- [ ] TypeScript ì»´íŒŒì¼ ì—ëŸ¬ 0ê±´
- [ ] ESLint ê²½ê³  0ê±´
- [ ] ëª¨ë“  import ì •ìƒ ì‘ë™

### 6.2 ëŸ°íƒ€ì„ ê²€ì¦

- [ ] API ì‘ë‹µ ì •ìƒ ë°˜í™˜
- [ ] í†µê³„ ê°’ì´ NaNì´ ì•„ë‹˜
- [ ] ì‚¬ë¶„ë©´ ë¶„í¬ ì •ìƒ ê³„ì‚°
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ì •ìƒ ì‘ë™

### 6.3 ë°ì´í„° ê²€ì¦

- [ ] JSON ë°ì´í„° ì •ìƒ íŒŒì‹±
- [ ] ëª¨ë“  í•„ë“œ ì •ìƒ ì ‘ê·¼
- [ ] í†µê³„ ê³„ì‚° ì •í™•ì„± í™•ì¸

---

## ğŸ¯ 7. ì˜ˆë°© ì¡°ì¹˜

### 7.1 ê°œë°œ í”„ë¡œì„¸ìŠ¤ ê°œì„ 

| ê°œì„  í•­ëª© | í˜„ì¬ ìƒíƒœ | ê°œì„  ë°©ì•ˆ |
|-----------|-----------|-----------|
| íƒ€ì… ê²€ì¦ | ìˆ˜ë™ | ìë™í™”ëœ íƒ€ì… ì²´í¬ |
| ë°ì´í„° êµ¬ì¡° ê²€ì¦ | ì—†ìŒ | JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦ |
| ì»´íŒŒì¼ ê²€ì¦ | ìˆ˜ë™ | CI/CD íŒŒì´í”„ë¼ì¸ |

### 7.2 ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬

```bash
# íƒ€ì… ì²´í¬ ìë™í™”
npm run type-check

# ë¦°íŒ… ìë™í™”
npm run lint

# ë°ì´í„° êµ¬ì¡° ê²€ì¦
npm run validate-data
```

---

## ğŸ“ 8. ê²°ë¡ 

### 8.1 í˜„ì¬ ìƒíƒœ

- âŒ **ì»´íŒŒì¼ ë¶ˆê°€ëŠ¥**
- âŒ **ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ**
- âŒ **ì˜ëª»ëœ í†µê³„ ê³„ì‚°**
- âŒ **ë°ì´í„° êµ¬ì¡° ë¶ˆì¼ì¹˜**

### 8.2 ìˆ˜ì • í›„ ì˜ˆìƒ ìƒíƒœ

- âœ… **ì»´íŒŒì¼ ì„±ê³µ**
- âœ… **ëŸ°íƒ€ì„ ì •ìƒ ì‘ë™**
- âœ… **ì •í™•í•œ í†µê³„ ê³„ì‚°**
- âœ… **ë°ì´í„° êµ¬ì¡° ì¼ì¹˜**

### 8.3 ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ**: íƒ€ì… ì •ì˜ ìˆ˜ì •
2. **1ì‹œê°„ ë‚´**: ëª¨ë“  ì—ëŸ¬ ìˆ˜ì • ì™„ë£Œ
3. **1ì¼ ë‚´**: ê²€ì¦ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
4. **ì§€ì†ì **: ìë™í™”ëœ ê²€ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•

---

**ì‘ì„±ì¼**: 2025ë…„ 1ì›” 27ì¼  
**ì‘ì„±ì**: VEATIC ì—°êµ¬íŒ€  
**ë²„ì „**: v1.0  
**ìƒíƒœ**: ğŸ”´ Critical - ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

---

## ğŸ“‹ 9. ì°¸ê³  ìë£Œ

- [TypeScript íƒ€ì… ì •ì˜ ê°€ì´ë“œ](./01.VAí‰ë©´_êµ¬í˜„ê³„íš.md)
- [ì—ëŸ¬ í•´ê²° ëª¨ë“ˆ ê°€ì´ë“œ](./03.ì—ëŸ¬í•´ê²°_Module_Not_Found.md)
- [API ì„¤ê³„ ì›ì¹™](../va-visualization/lib/types/api.types.ts)
- [ê°ì • ë°ì´í„° íƒ€ì… ì •ì˜](../va-visualization/lib/types/emotion.types.ts)
