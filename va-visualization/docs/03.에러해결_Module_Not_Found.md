# 03. Module Not Found 에러 해결 계획서

> **문제**: Next.js 빌드 시 모듈을 찾을 수 없는 에러 발생  
> **날짜**: 2025년 10월 3일  
> **프로젝트**: V-A 감정 공간 시각화

---

## 🚨 1. 에러 분석

### 1.1 발생한 에러 목록

```text
1. next.config.ts → next.config.js 변환 필요
2. Module not found: Can't resolve '@/lib/constants/visualization'
3. Module not found: Can't resolve '@/lib/hooks/useEmotionData'
```

### 1.2 에러 원인 분석

#### **원인 1: Next.js 설정 파일 형식 불일치**

- **문제**: `next.config.ts` 사용
- **원인**: Next.js 14.2.33은 TypeScript 설정 파일 미지원
- **해결**: `next.config.js`로 변환 필요

#### **원인 2: 모듈 경로 해결 실패**

- **문제**: 빌드 시 `@/lib/*` 경로의 모듈을 찾지 못함
- **원인**:
  1. `tsconfig.json`의 경로 매핑 설정 누락 또는 오류
  2. 실제 파일이 존재하지만 import/export 구조 문제
  3. 파일 확장자 문제 (.ts, .tsx)
- **해결**: 경로 매핑 확인 및 모듈 구조 재구성

#### **원인 3: 순환 참조 가능성**

- **문제**: 컴포넌트 간 import가 복잡하게 얽혀있을 가능성
- **원인**: 상호 의존적인 모듈 구조
- **해결**: 모듈 의존성 트리 재설계

---

## 🔧 2. 해결 방안

### 2.1 즉각 해결 (Critical)

#### **Step 1: next.config.js 생성**

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  compress: true,
  reactStrictMode: true,
  swcMinify: true,
  
  images: {
    formats: ['image/avif', 'image/webp'],
    minimumCacheTTL: 60,
  },

  webpack: (config) => {
    config.resolve.alias = {
      ...config.resolve.alias,
      '@': require('path').resolve(__dirname),
    };
    return config;
  },
};

module.exports = nextConfig;
```

#### **Step 2: tsconfig.json 경로 매핑 확인**

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"],
      "@/lib/*": ["./lib/*"],
      "@/app/*": ["./app/*"],
      "@/components/*": ["./app/components/*"]
    }
  }
}
```

### 2.2 모듈 구조 재설계 (Architectural)

#### **설계 원칙**

1. **SOLID 원칙** 준수
   - Single Responsibility: 각 모듈은 단일 책임
   - Open/Closed: 확장 가능, 수정 최소화
   - Liskov Substitution: 인터페이스 일관성
   - Interface Segregation: 필요한 인터페이스만 의존
   - Dependency Inversion: 추상화에 의존

2. **책임 분리 원칙**
   - Presentation Layer: UI 컴포넌트
   - Business Logic Layer: 데이터 처리 로직
   - Data Layer: API 통신 및 데이터 관리

3. **모듈성 (Modularity)**
   - 독립적인 모듈로 분리
   - 명확한 public API
   - 최소한의 의존성

4. **원자성 (Atomicity)**
   - 작고 재사용 가능한 단위로 분해
   - 테스트 가능한 작은 함수들

---

## 📁 3. 새로운 프로젝트 구조

### 3.1 디렉토리 구조 (재설계)

```text
va-visualization/
├─ app/
│  ├─ components/           # Presentation Layer
│  │  ├─ core/             # 핵심 UI 컴포넌트
│  │  │  ├─ VAPlane/
│  │  │  │  ├─ index.tsx
│  │  │  │  ├─ VAPlane.types.ts
│  │  │  │  └─ VAPlane.styles.ts
│  │  │  ├─ ScatterPlot/
│  │  │  │  ├─ index.tsx
│  │  │  │  ├─ ScatterPlot.types.ts
│  │  │  │  └─ Point.tsx
│  │  │  ├─ EmotionTooltip/
│  │  │  │  ├─ index.tsx
│  │  │  │  └─ EmotionTooltip.types.ts
│  │  │  └─ EmotionPrototypes/
│  │  │     ├─ index.tsx
│  │  │     └─ prototypes.config.ts
│  │  └─ ui/               # 재사용 UI 요소
│  │     ├─ Button.tsx
│  │     ├─ SearchBar.tsx
│  │     └─ LoadingSpinner.tsx
│  ├─ api/
│  │  ├─ emotions/route.ts
│  │  ├─ search/route.ts
│  │  └─ statistics/route.ts
│  ├─ page.tsx
│  ├─ layout.tsx
│  └─ globals.css
│
├─ lib/                     # Business Logic + Data Layer
│  ├─ core/                # 핵심 비즈니스 로직
│  │  ├─ emotion/
│  │  │  ├─ EmotionDataManager.ts    # 데이터 관리
│  │  │  ├─ EmotionFilter.ts         # 필터링 로직
│  │  │  └─ EmotionCalculator.ts     # 계산 로직
│  │  └─ visualization/
│  │     ├─ CoordinateSystem.ts      # 좌표 변환
│  │     ├─ ColorMapper.ts           # 색상 매핑
│  │     └─ ScaleManager.ts          # 스케일 관리
│  │
│  ├─ services/            # External Services
│  │  ├─ api/
│  │  │  ├─ EmotionApiClient.ts
│  │  │  └─ ApiConfig.ts
│  │  └─ cache/
│  │     └─ DataCache.ts
│  │
│  ├─ hooks/               # React Hooks
│  │  ├─ data/
│  │  │  ├─ useEmotionData.ts
│  │  │  ├─ useEmotionSearch.ts
│  │  │  └─ useEmotionStatistics.ts
│  │  ├─ interaction/
│  │  │  ├─ useHover.ts
│  │  │  ├─ useMousePosition.ts
│  │  │  └─ useViewport.ts
│  │  └─ performance/
│  │     ├─ useVirtualization.ts
│  │     └─ useDebounce.ts
│  │
│  ├─ types/               # TypeScript Types
│  │  ├─ emotion.types.ts
│  │  ├─ visualization.types.ts
│  │  └─ api.types.ts
│  │
│  ├─ constants/           # 상수 정의
│  │  ├─ colors.const.ts
│  │  ├─ visualization.const.ts
│  │  └─ api.const.ts
│  │
│  └─ utils/               # Utility Functions
│     ├─ math/
│     │  ├─ geometry.util.ts
│     │  └─ statistics.util.ts
│     ├─ format/
│     │  ├─ color.util.ts
│     │  └─ number.util.ts
│     └─ validation/
│        └─ data.validator.ts
│
├─ public/
│  └─ data/
│     └─ merged_vad.json
│
├─ next.config.js          # ✅ .js로 변경
├─ tsconfig.json
├─ package.json
└─ README.md
```

---

## 🎯 4. 모듈별 책임 정의

### 4.1 Presentation Layer (app/components/)

#### **4.1.1 책임**

- UI 렌더링
- 사용자 이벤트 처리
- 비즈니스 로직 호출 (직접 구현 X)

#### **4.1.2 원칙**

- Props를 통한 데이터 수신
- Callback을 통한 이벤트 전달
- 상태 관리는 최소화 (local state만)

### 4.2 Business Logic Layer (lib/core/)

#### **4.2.1 책임**

- 데이터 변환 및 계산
- 비즈니스 규칙 적용
- 알고리즘 구현

#### **4.2.2 원칙**

- Pure Function 지향
- React 독립적
- 테스트 용이성

### 4.3 Data Layer (lib/services/)

#### **4.3.1 책임**

- 외부 데이터 소스 접근
- API 통신
- 데이터 캐싱

#### **4.3.2 원칙**

- 에러 처리 포함
- 재시도 로직
- 타임아웃 관리

### 4.4 Hooks Layer (lib/hooks/)

#### **4.4.1 책임**

- React 상태 관리와 비즈니스 로직 연결
- 사이드 이펙트 관리
- 컴포넌트 로직 재사용

#### **4.4.2 원칙**

- Custom Hook 규칙 준수
- 의존성 배열 최적화
- 메모이제이션 적용

---

## 📋 5. 구현 단계별 TODO

### Phase 1: 기반 구조 (Foundation) - 우선순위: 🔴 Critical

#### ✅ Task 1.1: 설정 파일 수정

- [ ] `next.config.js` 생성 및 설정
- [ ] `tsconfig.json` 경로 매핑 확인
- [ ] `package.json` scripts 검증

#### ✅ Task 1.2: 타입 정의 (Types)

- [ ] `lib/types/emotion.types.ts` 생성
- [ ] `lib/types/visualization.types.ts` 생성
- [ ] `lib/types/api.types.ts` 생성
- [ ] 모든 타입을 단일 책임으로 분리

#### ✅ Task 1.3: 상수 정의 (Constants)

- [ ] `lib/constants/colors.const.ts` 생성
- [ ] `lib/constants/visualization.const.ts` 생성
- [ ] `lib/constants/api.const.ts` 생성

### Phase 2: 유틸리티 레이어 - 우선순위: 🟡 High

#### ✅ Task 2.1: 수학 유틸리티

- [ ] `lib/utils/math/geometry.util.ts` - 좌표 계산
- [ ] `lib/utils/math/statistics.util.ts` - 통계 계산

#### ✅ Task 2.2: 포맷 유틸리티

- [ ] `lib/utils/format/color.util.ts` - 색상 변환
- [ ] `lib/utils/format/number.util.ts` - 숫자 포맷팅

#### ✅ Task 2.3: 검증 유틸리티

- [ ] `lib/utils/validation/data.validator.ts` - 데이터 검증

### Phase 3: 핵심 비즈니스 로직 - 우선순위: 🔴 Critical

#### ✅ Task 3.1: 감정 데이터 관리

- [ ] `lib/core/emotion/EmotionDataManager.ts`
- [ ] `lib/core/emotion/EmotionFilter.ts`
- [ ] `lib/core/emotion/EmotionCalculator.ts`

#### ✅ Task 3.2: 시각화 로직

- [ ] `lib/core/visualization/CoordinateSystem.ts`
- [ ] `lib/core/visualization/ColorMapper.ts`
- [ ] `lib/core/visualization/ScaleManager.ts`

### Phase 4: 서비스 레이어 - 우선순위: 🟡 High

#### ✅ Task 4.1: API 클라이언트

- [ ] `lib/services/api/EmotionApiClient.ts`
- [ ] `lib/services/api/ApiConfig.ts`

#### ✅ Task 4.2: 캐싱

- [ ] `lib/services/cache/DataCache.ts`

### Phase 5: React Hooks - 우선순위: 🟡 High

#### ✅ Task 5.1: 데이터 Hooks

- [ ] `lib/hooks/data/useEmotionData.ts`
- [ ] `lib/hooks/data/useEmotionSearch.ts`
- [ ] `lib/hooks/data/useEmotionStatistics.ts`

#### ✅ Task 5.2: 상호작용 Hooks

- [ ] `lib/hooks/interaction/useHover.ts`
- [ ] `lib/hooks/interaction/useMousePosition.ts`
- [ ] `lib/hooks/interaction/useViewport.ts`

#### ✅ Task 5.3: 성능 Hooks

- [ ] `lib/hooks/performance/useVirtualization.ts`
- [ ] `lib/hooks/performance/useDebounce.ts`

### Phase 6: UI 컴포넌트 - 우선순위: 🟢 Medium

#### ✅ Task 6.1: 핵심 컴포넌트

- [ ] `app/components/core/VAPlane/index.tsx`
- [ ] `app/components/core/ScatterPlot/index.tsx`
- [ ] `app/components/core/EmotionTooltip/index.tsx`
- [ ] `app/components/core/EmotionPrototypes/index.tsx`

#### ✅ Task 6.2: UI 컴포넌트

- [ ] `app/components/ui/Button.tsx`
- [ ] `app/components/ui/SearchBar.tsx`
- [ ] `app/components/ui/LoadingSpinner.tsx`

### Phase 7: 페이지 및 API - 우선순위: 🟡 High

#### ✅ Task 7.1: API Routes

- [ ] `app/api/emotions/route.ts` 재작성
- [ ] `app/api/search/route.ts` 재작성
- [ ] `app/api/statistics/route.ts` 재작성

#### ✅ Task 7.2: 메인 페이지

- [ ] `app/page.tsx` 리팩토링

### Phase 8: 테스트 및 최적화 - 우선순위: 🟢 Medium

#### ✅ Task 8.1: 단위 테스트

- [ ] 유틸리티 함수 테스트
- [ ] 비즈니스 로직 테스트

#### ✅ Task 8.2: 통합 테스트

- [ ] API 테스트
- [ ] 컴포넌트 테스트

#### ✅ Task 8.3: 성능 최적화

- [ ] 번들 크기 분석
- [ ] 렌더링 최적화
- [ ] 메모리 사용 최적화

---

## 🔍 6. 의존성 관계 다이어그램

```text
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│  (app/components/, app/page.tsx)        │
│                                         │
│  - VAPlane                              │
│  - ScatterPlot                          │
│  - EmotionTooltip                       │
│  - EmotionPrototypes                    │
└──────────────┬──────────────────────────┘
               │ uses
               ↓
┌─────────────────────────────────────────┐
│            Hooks Layer                  │
│         (lib/hooks/)                    │
│                                         │
│  - useEmotionData                       │
│  - useEmotionSearch                     │
│  - useHover                             │
│  - useVirtualization                    │
└──────────────┬──────────────────────────┘
               │ uses
               ↓
┌─────────────────────────────────────────┐
│       Business Logic Layer              │
│         (lib/core/)                     │
│                                         │
│  - EmotionDataManager                   │
│  - CoordinateSystem                     │
│  - ColorMapper                          │
└──────────────┬──────────────────────────┘
               │ uses
               ↓
┌─────────────────────────────────────────┐
│          Data Layer                     │
│       (lib/services/)                   │
│                                         │
│  - EmotionApiClient                     │
│  - DataCache                            │
└──────────────┬──────────────────────────┘
               │ uses
               ↓
┌─────────────────────────────────────────┐
│      Utility & Types Layer              │
│    (lib/utils/, lib/types/)             │
│                                         │
│  - geometry.util                        │
│  - color.util                           │
│  - emotion.types                        │
└─────────────────────────────────────────┘
```

---

## ✅ 7. 성공 기준 (Definition of Done)

### 7.1 기능적 요구사항

- [x] 빌드 에러 0건
- [ ] 모든 모듈 정상 import/export
- [ ] 54,893개 감정 데이터 정상 로딩
- [ ] V-A 평면 정상 렌더링
- [ ] 마우스 hover 시 툴팁 정상 표시
- [ ] 검색 기능 정상 작동

### 7.2 비기능적 요구사항

- [ ] 초기 로딩 시간 < 3초
- [ ] 번들 크기 < 1MB (gzip)
- [ ] Lighthouse 성능 점수 > 90
- [ ] TypeScript 타입 커버리지 100%

### 7.3 코드 품질

- [ ] ESLint 오류 0건
- [ ] Prettier 포맷팅 완료
- [ ] 주석 및 문서화 완료
- [ ] 단위 테스트 커버리지 > 80%

---

## 📝 8. 구현 시 주의사항

### 8.1 순환 참조 방지

```typescript
// ❌ Bad: 순환 참조
// A.ts imports B.ts
// B.ts imports A.ts

// ✅ Good: 단방향 의존성
// A.ts imports C.ts
// B.ts imports C.ts
// C.ts는 독립적
```

### 8.2 타입 안정성

```typescript
// ❌ Bad: any 사용
const data: any = fetchData();

// ✅ Good: 명시적 타입
interface EmotionData {
  term: string;
  valence: number;
  arousal: number;
}
const data: EmotionData = fetchData();
```

### 8.3 성능 최적화

```typescript
// ❌ Bad: 매번 재계산
const filtered = emotions.filter(e => e.valence > 0);

// ✅ Good: 메모이제이션
const filtered = useMemo(
  () => emotions.filter(e => e.valence > 0),
  [emotions]
);
```

---

## 🚀 9. 다음 단계

1. **즉시**: Phase 1 (기반 구조) 구현 시작
2. **1일차**: Phase 1-3 완료
3. **2일차**: Phase 4-5 완료
4. **3일차**: Phase 6-7 완료
5. **4일차**: Phase 8 완료 및 최종 테스트

---

**작성일**: 2025년 10월 3일  
**작성자**: VEATIC 연구팀  
**버전**: v1.0  
**상태**: 🔴 진행 중

---

## Todo

Phase 1.1: next.config.js 생성 및 tsconfig.json 경로 매핑 설정
Phase 1.2: 타입 정의 파일 생성 (emotion.types.ts, visualization.types.ts, api.types.ts)
Phase 1.3: 상수 정의 파일 생성 (colors.const.ts, visualization.const.ts, api.const.ts)
Phase 2: 유틸리티 레이어 구현 (geometry, statistics, color, number, validator)
Phase 3: 핵심 비즈니스 로직 구현 (EmotionDataManager, CoordinateSystem, ColorMapper)
Phase 4: 서비스 레이어 구현 (EmotionApiClient, DataCache)
Phase 5: React Hooks 구현 (useEmotionData, useHover, useVirtualization 등)
Phase 6: UI 컴포넌트 리팩토링 (VAPlane, ScatterPlot, EmotionTooltip, EmotionPrototypes)
Phase 7: 페이지 및 API Routes 재작성
Phase 8: 테스트 및 최적화 (단위 테스트, 통합 테스트, 성능 최적화)
